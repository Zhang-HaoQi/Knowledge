# 多线程

## 参考文章

[Java多线程，程序运行的堆栈分析](https://www.cnblogs.com/loveyous/p/11407504.html)

## 1. 多线程概述

### 进程与线程的关系

**进程:**一个应用程序，进程与进程之间不能进行数据共享。一个程序可以启动多个线程。

**线程：**一个进程中的执行场景/执行单元，线程与线程之前可以进行数据共享。

**进程与线程的关系**

进程和线程之间的关系就好比餐厅和员工。一个餐厅A有多个员工，员工与员工之间可以共享这个餐厅A的资源。餐厅B是另一个餐厅，餐厅A和餐厅B之间不能进行数据共享。

QQ音乐，和穿越火线是两个进程，他们是独立的，不共享资源。

**Java中的进程与线程：**

对Java程序而言，但我们使用  java  HellWorld运行Java文件时，会先启动JVM虚拟机，JVM就是一个进程，JVM再启动一个主线程调用main方法，同时启动一个垃圾回收线程负责看护，回收垃圾。

一个Java程序至少有两个线程并发，一个是垃圾回收线程，一个是执行main方法的主线程。

Java程序中，线程A和线程B，堆内存和方法区内存共享，但是栈内存独立，一个线程一个栈。如果有10个线程，就会有十个栈，每个栈之间互不干扰，各自执行各自的，这就是多线程并发。

火车站的卖票窗口就是一个多线程，你可以在任何一个窗口买票，在窗口A买票并不影响在窗口B买票的乘客。火车票是他们的共享资源。

Java引入多线程，主要是为了提高程序的处理效率。

### 堆，方法取，共享栈

Java程序中，线程A和线程B，堆内存和方法区内存共享，但是栈内存独立，一个线程一个栈。如果有10个线程，就会有十个栈，每个栈之间互不干扰，各自执行各自的。

**问题：**使用了多线程后，main方法结束，程序是否就一定结束？

main方法结束只是主线程结束，主栈空了，但是其他的栈（线程）可能还在运行

![image-20211204144459273](https://mynotepicbed.oss-cn-beijing.aliyuncs.com/img/image-20211204144459273.png)

### 多线程并发

**单核CPU：**

不能做到多线程并发，但是可以给人一种多线程并发的错觉。单核cpu在一个时间点上只能处理一件事情但是由于CPU处理极快，多个线程之间频繁切换，给人的感觉是多个事情同时在做。

线程A：播放音乐，线程B：运行魔兽游戏。

线程A与线程B的频繁切换执行，给人一种音乐和游戏同时运行，给我们并发的错觉。

**多核CPU**

多核CPU在同一个时间节点上，可以真正的多个进行并发执行。

**多线程并发**

线程a之前线程a的，线程b执行线程b的，二者不会相互影响。

![image-20211204150153258](https://mynotepicbed.oss-cn-beijing.aliyuncs.com/img/image-20211204150153258.png)

